<!Doctype html>
<html>
	<body>
		<canvas id="tabuleiro" style="float: right; border:1px solid #000000;" width="800" height="400"></canvas>
		<div>
			<textarea id="entrada" style="height: 400px; width: 300px; display: block;"></textarea>
			<input type="submit" value="Executar" onclick="executaComandos(2, 1, 'direita')" />
		</div>
	</body>
</html>

<img id="carro" src="carro.png" hidden="true"/>

<script>
var bola = function(x,y,cor) {
	ctx.fillStyle = cor;
	ctx.beginPath();
  	ctx.arc(x*tamanhoQuadrado, y*tamanhoQuadrado, 5, 0, Math.PI*2, true);
	ctx.fill();
}

var carro = function(x,y,direcao) {
	ctx.drawImage(document.getElementById("carro"), x*tamanhoQuadrado-10, y*tamanhoQuadrado-10);
}

var andaHorizontal = function(origemX, origemY, quadrasPraDireita) {
	var multiplicador = (quadrasPraDireita > 0) ? 1 : -1;
	quadrasPraDireita = quadrasPraDireita * multiplicador;
	for (i = 1; i <= quadrasPraDireita; i++) {
		bola(origemX + (i * multiplicador), origemY, "#339");
	}
}

var andaVertical = function(origemX, origemY, quadrasPraBaixo) {
	var multiplicador = (quadrasPraBaixo > 0) ? 1 : -1;
	quadrasPraBaixo = quadrasPraBaixo * multiplicador;
	for (i = 1; i <= quadrasPraBaixo; i++) {
		bola(origemX, origemY + (i * multiplicador), "#339");
	}
}

var ande = function(origem, quadras, direcao) {
	if (direcao == "direita") {
		andaHorizontal(origem[0], origem[1], quadras);
		return [origem[0] + quadras, origem[1]];
	} else if (direcao == "esquerda") {
		andaHorizontal(origem[0], origem[1], -quadras);
		return [origem[0] - quadras, origem[1]];
	} else if (direcao == "baixo") {
		andaVertical(origem[0], origem[1], quadras);
		return [origem[0], origem[1] + quadras];
	} else if (direcao == "cima") {
		andaVertical(origem[0], origem[1], -quadras);
		return [origem[0], origem[1] - quadras];
	}
}

var processaDirecao = function(direcaoAtual, virandoPara) {
	var direcoes = ["direita", "baixo", "esquerda", "cima"];
	var indice = direcoes.indexOf(direcaoAtual);
	if (virandoPara == "direita") {
		indice = (indice + 1) % 4;
	} else if (virandoPara == "esquerda") {
		indice = (indice + 3) % 4;
	}
	return direcoes[indice];
}

function executaComandos(inicioX, inicioY, inicioDirecao) {
	var posicao = [inicioX, inicioY];
	var direcao = processaDirecao(inicioDirecao);

	var entrada = document.getElementById("entrada").value;
	var comandos = entrada.split(";");
	for (var i = 0; i < comandos.length; i++) {
		var comando = comandos[i].replace("\n", "");
		alert("Executando: " + comando);
		var texto = comando.split(" ");
		if (texto.length == 4 && 
					texto[0] == "vire" && 
					texto[1] == "para" &&
					texto[2] == "a" && 
					(texto[3] == "direita" || texto[3] == "esquerda")) {
			direcao = processaDirecao(direcao, texto[3]);
		} else if (texto.length == 3 && 
					texto[0] == "ande" && 
					(texto[2] == "quadra" || texto[2] == "quadras")) {
			var quantidade = texto[1];
			posicao = ande(posicao, quantidade, direcao);
		} else {
			alert("Comando invalido: " + comando);
		}
	}

}


var tabuleiro = document.getElementById("tabuleiro");
var ctx = tabuleiro.getContext("2d");

var tamanhoQuadrado = 40;
var numLargura = tabuleiro.width / tamanhoQuadrado;
var numAltura = tabuleiro.height / tamanhoQuadrado;

for (x = 0; x< numLargura; x++) {
	for (y = 0; y< numAltura; y++) {
		ctx.lineWidth=0.5;
  		ctx.strokeRect(x*tamanhoQuadrado ,y*tamanhoQuadrado,tamanhoQuadrado,tamanhoQuadrado);
		ctx.fill();
	}
}

bola(2, 1, "#3A3");
bola(12, 6, "#F00");
carro(2, 1, "direita");

</script>
